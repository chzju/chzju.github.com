---
layout: post
title: 数据库分片关键技术
category: posts
---

1. 分布式全局唯一id
	1. Twitter的Snowflake 64位唯一Id（由41位的timestamp+ 10位自定义的机器码+ 13位累加计数器组成）
	1. UUID/GUID（一般应用程序和数据库均支持）
	1. MongoDB ObjectID（类似UUID的方式）
	1. Ticket Server（数据库生存方式，Flickr采用的就是这种方式）

1. 分片字段：
	1. 结合实际业务，通过对系统中执行的sql语句进行统计分析，选择出需要分片的那个表中最频繁被使用，或者最重要的字段来作为分片字段。

1. 分片策略
	1. 连续分片：方便定位，但是会有数据热点
	1. 随机分片：数据分布均匀，使用一致性Hash算法可以快速扩容无需迁移数据。但是离散分片还是非常容易发生跨分片查询的问题。

1. 跨分片技术问题
    1. 问题：
        1. 跨分片的排序分页
        1. 跨分片的函数处理
        1. 跨分片join
        1. 跨分片事务问题
    1. 方案：
        1. 全局表：把一些类似数据字典又可能会产生join查询的表信息放到各分片中，从而避免跨分片的join。
        2. ER分片：把存在关联关系的表记录存放在同一个分片上
        1. 内存计算：

1. 经验：
    1. 单表1000W左右的数据无需分片
    1. 不宜早
    1. 过渡技术–“表分区”


1. 分片解决方案：
    1. 基于应用程序层面的DDAL（分布式数据库访问层）  TDDL等
    1. 数据库代理服务器mycat、kingshard


refs:
[参考资料1][1]

[1]: http://mp.weixin.qq.com/s?__biz=MzA5Nzc4OTA1Mw==&mid=2659598156&idx=1&sn=b5d4e509dc6a9c908bef2bad8ce27a25#rd
